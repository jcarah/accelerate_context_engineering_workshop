# Contributing & Development Guide

> **For workshop maintainers only.** Participants should use [README.md](README.md) and [REFERENCE.md](REFERENCE.md).

**Last Updated:** 2026-01-28

---

## Quick Reference

| What | Where |
|------|-------|
| Workshop guide (participants follow this) | `README.md` |
| Deep dive & customization | `REFERENCE.md` |
| AI assistant context | `GEMINI.md` |
| This file (internal team) | `CONTRIBUTING.md` |

---

## Repository Structure

```
accelerate/
â”œâ”€â”€ README.md                    # Workshop guide - participants follow this
â”œâ”€â”€ REFERENCE.md                 # Deep dive - CLI, metrics, troubleshooting
â”œâ”€â”€ GEMINI.md                    # AI assistant context for CLI tools
â”œâ”€â”€ CONTRIBUTING.md              # This file - team internal
â”œâ”€â”€ setup_workshop.sh            # Environment verification script
â”‚
â”œâ”€â”€ customer-service/            # Agent A: Multi-turn chatbot
â”‚   â”œâ”€â”€ customer_service/        # Agent source code
â”‚   â””â”€â”€ eval/                    # Scenarios, metrics, results
â”‚       â”œâ”€â”€ results/baseline/    # Baseline evaluation results
â”‚       â””â”€â”€ results/optimization/# Optimization results (on opt branches)
â”‚
â”œâ”€â”€ retail-ai-location-strategy/ # Agent B: Location analysis pipeline
â”‚   â”œâ”€â”€ app/                     # Agent source code
â”‚   â””â”€â”€ eval/                    # Golden dataset, metrics, results
â”‚
â””â”€â”€ evaluation/                  # Shared evaluation CLI (agent-eval)
    â””â”€â”€ src/evaluation/cli/      # CLI commands
```

---

## Optimization Branches

Each optimization branch contains:
1. **Agent code changes** - The actual optimization
2. **optimization/ folder** - Evaluation results for the optimized code
3. **OPTIMIZATION_LOG.md** - Comparison of baseline vs optimization metrics

| Branch | Agent | Status |
|--------|-------|--------|
| `main` | Both | âœ… Ready - baseline evaluations |
| `optimizations/01-tool-definition` | Customer Service | âœ… Complete |
| `optimizations/02-context-compaction` | Customer Service | ðŸ”„ In Progress |
| `optimizations/03-functional-isolation` | Customer Service | ðŸ“‹ Pending |
| `optimizations/04-offload-and-reduce` | Retail AI | ðŸ“‹ Pending |

### Updating a Branch

1. Checkout the branch
2. Merge latest main: `git merge origin/main`
3. Keep agent code changes, use main for everything else
4. Run evaluation to create `optimization/` folder
5. Create `OPTIMIZATION_LOG.md` (see GEMINI.md for template)
6. Push

---

## Key Gotchas

### Vertex AI is Required
```
MUST use: GOOGLE_CLOUD_PROJECT + GOOGLE_CLOUD_LOCATION
DO NOT use: GOOGLE_API_KEY (metrics will be empty)
```

### evalset.json Files
- Auto-generated by `adk eval_set` commands
- Gitignored - don't commit them
- Clear before each run: `rm -f agent/*.evalset.json`

### Multi-turn vs Single-turn Metrics
- Customer Service uses `multi_turn_*` metrics (conversation)
- Retail AI uses single-turn metrics like `general_quality`

---

## Running Evaluations

### Customer Service (ADK User Sim)
```bash
cd customer-service
rm -rf customer_service/.adk/eval_history/*
uv run adk eval_set create customer_service eval_set_with_scenarios
uv run adk eval_set add_eval_case customer_service eval_set_with_scenarios \
  --scenarios_file eval/scenarios/conversation_scenarios.json \
  --session_input_file eval/scenarios/session_input.json
uv run adk eval customer_service eval_set_with_scenarios

cd ../evaluation
uv run agent-eval convert --agent-dir ../customer-service/customer_service --output-dir ../customer-service/eval/results
# Rename timestamped folder to optimization/ or baseline/
uv run agent-eval evaluate --interaction-file <folder>/raw/processed_interaction_sim.jsonl --metrics-files ../customer-service/eval/metrics/metric_definitions.json --results-dir <folder>
uv run agent-eval analyze --results-dir <folder> --agent-dir ../customer-service --location global
```

### Retail AI (DIY Interactions)
```bash
# Terminal 1: Start agent
cd retail-ai-location-strategy && make dev

# Terminal 2: Run evaluation
cd evaluation
uv run agent-eval interact --app-name app --questions-file ../retail-ai-location-strategy/eval/eval_data/golden_dataset.json --base-url http://localhost:8502 --results-dir ../retail-ai-location-strategy/eval/results
uv run agent-eval evaluate --interaction-file <folder>/raw/processed_interaction_app.jsonl --metrics-files ../retail-ai-location-strategy/eval/metrics/metric_definitions.json --results-dir <folder>
uv run agent-eval analyze --results-dir <folder> --agent-dir ../retail-ai-location-strategy --location global
```

---

## Creating Optimization Logs

See `GEMINI.md` for detailed instructions on creating `OPTIMIZATION_LOG.md` files that compare baseline vs optimization metrics.

Key sections:
1. **Metrics Comparison Table** - Deterministic + LLM metrics with deltas
2. **Iteration History** - What was changed and why
3. **Conclusions** - What worked, what needs attention

---

## Contacts

- **Dani** - Evaluation framework, documentation
- **John** - Customer Service optimizations (01-03)
- **Hugo** - Retail AI optimizations (04)
- **Liz** - Testing, validation

{
    "metric_prefix": "carbon_chart",
    "metrics":{
    "validity": {
        "description": "A metric that answers the question 'Is the generated carbon chart structurally valid according to Carbon Charts specification?'",
        "rubric": "1 (Valid): Chart has all required structural fields and correct mappings. 0 (Invalid): Chart is missing required fields or has invalid structure.",
        "threshold": 0.8,
        "range": "[0, 1]",
        "agents": ["visualization"],
        "template": "You are a Carbon Charts validation expert. Your task is to evaluate if a generated Carbon chart has all the required structural elements according to the Carbon Charts specification. This is a STRUCTURAL validation only - do NOT evaluate semantic aspects like chart type appropriateness or data relevance. Assign a score from 0 to 1, where 1 is structurally valid and 0 is invalid.\n\n### IMPORTANT: Field Names Are Dynamic\nThe data field names (like 'location', 'active_pick_orders', 'SKU', 'quantity', etc.) are DYNAMIC and derived from the SQL query. They are NOT required to be 'group', 'key', 'value'. The axes.mapsTo fields specify which data fields to use for visualization.\n\n### Expected Structure (field names are examples only):\n```json\n{\n  \"chart_type\": \"bar_chart\",\n  \"data\": [\n    {\"location\": \"A\", \"count\": 100},\n    {\"location\": \"B\", \"count\": 200}\n  ],\n  \"options\": {\n    \"title\": \"Chart Title\",\n    \"axes\": {\n      \"left\": {\n        \"mapsTo\": \"count\",\n        \"title\": \"Y-Axis Title\"\n      },\n      \"bottom\": {\n        \"mapsTo\": \"location\",\n        \"title\": \"X-Axis Title\",\n        \"scaleType\": \"labels\"\n      }\n    },\n    \"height\": \"400px\"\n  }\n}\n```\n\n### Structural Validation Criteria:\n1. **chart_type**: Must be one of: line_chart, bar_chart, pie_chart, scatter_plot, histogram\n2. **data**: Must be a non-empty array of objects (field names can be anything)\n3. **options.title**: Must exist and be a non-empty string\n4. **options.axes**: Must have both 'left' and 'bottom' axes defined\n5. **options.axes.left.mapsTo**: Must reference a field that exists in the data objects\n6. **options.axes.bottom.mapsTo**: Must reference a field that exists in the data objects\n7. **options.axes.left.title**: Must exist and be a non-empty string\n8. **options.axes.bottom.title**: Must exist and be a non-empty string\n9. **options.height**: Must exist and be a string (e.g., \"400px\")\n\n### Rating Rubric:\n**1.0 (Fully Valid)**:\n- All required structural fields are present and populated\n- chart_type is one of the valid types\n- data array exists and is non-empty\n- Both axes.mapsTo fields correctly reference fields that exist in the data objects\n- All required titles (chart title and axis titles) are present and non-empty\n- options.height is present and is a string\n\n**0.7-0.9 (Mostly Valid)**:\n- All critical structural requirements met\n- Minor issues: slightly malformed but interpretable structure\n- Axes mappings are correct\n\n**0.4-0.6 (Partially Valid)**:\n- Basic structure exists but has significant issues\n- One or more axes.mapsTo references non-existent fields\n- Missing some required titles\n- data array might be empty\n\n**0.1-0.3 (Mostly Invalid)**:\n- Missing critical structural elements (axes, options, or multiple required fields)\n- Invalid chart_type value\n- Broken data structure or malformed axes\n\n**0.0 (Completely Invalid)**:\n- Missing chart_type or data array entirely\n- Structure is fundamentally broken\n- Cannot be rendered as a chart due to missing core elements\n\n### Evaluation Steps:\n1. Check chart_type exists and is valid (line_chart, bar_chart, pie_chart, scatter_plot, histogram)\n2. Verify data array exists and is non-empty with objects\n3. Extract the field names from the first data object\n4. Verify options.title exists and is non-empty\n5. Verify options.axes.left and options.axes.bottom both exist\n6. Verify axes.left.mapsTo references an actual field from the data objects\n7. Verify axes.bottom.mapsTo references an actual field from the data objects\n8. Verify axes.left.title and axes.bottom.title exist and are non-empty\n9. Verify options.height exists and is a string\n\nProvide a step-by-step explanation for your score.\n\n# AI-generated Response\n## Generated Carbon Chart\n{response}",
        "dataset_mapping": {
            "response": {"source_column": "carbon_chart"}
        }
    },
    "json_validity": {
        "description": "A metric that answers the question 'Is the generated carbon chart valid JSON and parseable?'",
        "rubric": "1 (Valid JSON): The chart is valid, parseable JSON with correct structure. 0 (Invalid JSON): The chart has JSON syntax errors or cannot be parsed.",
        "threshold": 1.0,
        "range": "[0, 1]",
        "agents": ["visualization"],
        "template": "You are a JSON validation expert. Your task is to determine if a generated Carbon chart JSON is syntactically valid and parseable. Assign a score from 0 to 1, where 1 is valid JSON and 0 is invalid JSON.\n\n### Criteria:\n- The JSON must be syntactically correct and parseable\n- All braces, brackets, and quotes must be properly matched\n- No trailing commas or syntax errors\n- Must be a valid JSON object (not just a string or array at the root level)\n\n### Rating Rubric:\n1 (Valid JSON): The chart is valid, parseable JSON with correct syntax.\n0 (Invalid JSON): The chart has JSON syntax errors, cannot be parsed, or is not a valid JSON object.\n\n### Evaluation Steps:\n1. Attempt to parse the JSON\n2. Check for syntax errors (unmatched braces, quotes, etc.)\n3. Verify it's a proper JSON object\n4. Assign a score based on the rubric\n\nProvide a step-by-step explanation for your score.\n\n# AI-generated Response\n## Generated Carbon Chart\n{response}",
        "dataset_mapping": {
            "response": {"source_column": "carbon_chart"}
        }
    },
    "relevance": {
        "description": "A metric that answers the question 'Does the chart response answer the user's question?'",
        "rubric": "1 (Highly Relevant): The chart directly and effectively answers the user's question. 0 (Not Relevant): The chart is completely irrelevant to the. question.",
        "threshold": 0.8,
        "range": "[0, 1]",
        "agents": ["visualization"],
        "template": "You are a data visualization expert. Your task is to evaluate whether a generated Carbon chart effectively answers the user's question. Assign a score from 0 to 1, where 1 is highly relevant and 0 is not relevant.\n\n### Criteria:\n- The chart should visualize data that directly addresses the user's question\n- The chart should provide insights or answers that the user is seeking\n- The visualization should be appropriate for the type of question asked\n- The chart should help the user understand the answer to their question\n\n### Rating Rubric:\n**1.0 (Highly Relevant)**:\n- Chart directly and clearly answers the user's question\n- Data visualized is exactly what the user asked for\n- Chart type enhances understanding of the answer\n\n**0.7-0.9 (Mostly Relevant)**:\n- Chart answers the question with minor gaps\n- Data is relevant but may include some unnecessary information\n- Visualization is helpful but could be more focused\n\n**0.4-0.6 (Partially Relevant)**:\n- Chart addresses some aspects of the question\n- Data is somewhat related but may miss key points\n- Visualization provides limited insights\n\n**0.1-0.3 (Minimally Relevant)**:\n- Chart barely relates to the question\n- Data is tangentially related at best\n- Visualization doesn't help answer the question\n\n**0.0 (Not Relevant)**:\n- Chart is completely unrelated to the question\n- Data has no connection to what the user asked\n\n### Evaluation Steps:\n1. Analyze the user's question to understand what they're asking\n2. Review the chart data and type\n3. Assess if the chart directly answers the question\n4. Consider if the visualization enhances understanding\n5. Review the SQL query output for additional context\n6. Assign a score based on the rubric\n\nProvide a step-by-step explanation for your score.\n\n# User Inputs and AI-generated Response\n## User Inputs\n### User Question\n{prompt}\n\n### SQL Query Output (for context)\n{context}\n\n## AI-generated Response\n### Generated Carbon Chart\n{response}",
        "dataset_mapping": {
            "prompt": {"source_column": "user_inputs"},
            "context": {"source_column": "sql_query_output"},
            "response": {"source_column": "carbon_chart"}
        }
    },
    "labeling_quality": {
        "description": "A metric that answers the question 'Are the chart title and axis labels relevant, clear, and appropriate?'",
        "rubric": "1 (Excellent): Title and axis labels are highly relevant, clear, and descriptive. 0 (Poor): Title and labels are irrelevant, unclear, or missing.",
        "threshold": 0.8,
        "range": "[0, 1]",
        "agents": ["visualization"],
        "template": "You are a data visualization expert. Your task is to evaluate the quality of the chart title and axis labels in a generated Carbon chart. Assign a score from 0 to 1, where 1 is excellent and 0 is poor.\n\n### Criteria:\n- **Chart Title**: Should clearly describe what the chart shows and be relevant to the user's question\n- **Axis Labels**: Should accurately describe the data being displayed on each axis\n- **Clarity**: Labels should be clear, concise, and understandable for a general audience\n- **Relevance**: All labels should be directly relevant to the data and question\n- **Completeness**: Both axes should have meaningful titles (where applicable)\n\n### Rating Rubric:\n**1.0 (Excellent)**:\n- Chart title clearly and accurately describes the visualization\n- Axis labels precisely describe the data on each axis\n- All labels are relevant to the user's question\n- Labels are clear, professional, and easy to understand\n- Proper capitalization and formatting\n\n**0.7-0.9 (Good)**:\n- Title and labels are mostly clear and relevant\n- Minor issues with clarity or specificity\n- Could be slightly more descriptive or precise\n\n**0.4-0.6 (Adequate)**:\n- Title or labels are somewhat vague or generic\n- Relevance to the question is unclear\n- Some labels may be missing or poorly formatted\n\n**0.1-0.3 (Poor)**:\n- Title is generic, vague, or barely relevant\n- Axis labels are unclear or misleading\n- Missing important labels\n- Labels don't relate well to the question\n\n**0.0 (Very Poor)**:\n- Title is missing or completely irrelevant\n- Axis labels are missing or nonsensical\n- Labels provide no useful information\n\n### Evaluation Steps:\n1. Review the user's question to understand the context\n2. Extract the chart title from options.title\n3. Extract axis labels from options.axes.left.title and options.axes.bottom.title\n4. Assess if the title accurately describes what the chart shows\n5. Evaluate if axis labels clearly describe the data on each axis\n6. Check if labels are relevant to the user's question\n7. Assess overall clarity and professionalism\n8. Assign a score based on the rubric\n\nProvide a step-by-step explanation for your score.\n\n# User Inputs and AI-generated Response\n## User Inputs\n### User Question\n{prompt}\n\n## AI-generated Response\n### Generated Carbon Chart\n{response}",
        "dataset_mapping": {
            "prompt": {"source_column": "user_inputs"},
            "response": {"source_column": "carbon_chart"}
        }
    },
    "data_groundedness": {
        "description": "A metric that answers the question 'Is the chart data fully grounded in and consistent with the SQL query output?'",
        "rubric": "1 (Grounded): Chart data is fully consistent with the SQL output. 0 (Not Grounded): Chart data contradicts or is not derived from the SQL output.",
        "threshold": 0.8,
        "range": "[0, 1]",
        "agents": ["visualization"],
        "template": "You are a data analysis expert. Your task is to determine if the data in a generated Carbon chart is fully grounded in and consistent with the provided SQL query output. Assign a score from 0 to 1, where 1 is grounded and 0 is not grounded.\n\n### Criteria:\n- All data points in the chart must come from the SQL query output\n- Data values should match exactly or be properly aggregated from the SQL output\n- Field names used in the chart should correspond to columns in the SQL output\n- No data should be fabricated or hallucinated\n- Transformations (like aggregations) should be appropriate and accurate\n\n### Rating Rubric:\n**1.0 (Fully Grounded)**:\n- All chart data points directly correspond to the SQL output\n- Data values are accurate and verifiable from the SQL results\n- Field mappings are correct\n- No fabricated or hallucinated data\n\n**0.7-0.9 (Mostly Grounded)**:\n- Most data is accurate and comes from SQL output\n- Minor discrepancies in data transformation or rounding\n- Field names may be slightly renamed but clearly correspond to SQL columns\n\n**0.4-0.6 (Partially Grounded)**:\n- Some data comes from SQL output but has significant issues\n- Incorrect aggregations or transformations\n- Some field mappings are unclear or incorrect\n- Mix of accurate and inaccurate data\n\n**0.1-0.3 (Minimally Grounded)**:\n- Most data does not match the SQL output\n- Significant fabrication or misinterpretation\n- Field mappings are largely incorrect\n\n**0.0 (Not Grounded)**:\n- Chart data is completely fabricated\n- No correspondence with SQL output\n- Cannot verify any data points from the SQL results\n\n### Evaluation Steps:\n1. Review the SQL query output structure and values\n2. Extract the data array from the Carbon chart\n3. Compare chart data points with SQL query results\n4. Verify that field names in chart data correspond to SQL columns\n5. Check if data values match or are properly derived from SQL output\n6. Identify any fabricated or hallucinated data\n7. Assess if any transformations (aggregations, calculations) are accurate\n8. Assign a score based on the rubric\n\nProvide a step-by-step explanation for your score.\n\n# User Inputs and AI-generated Response\n## User Inputs\n### SQL Query Output\n{prompt}\n\n## AI-generated Response\n### Generated Carbon Chart\n{response}",
        "dataset_mapping": {
            "prompt": {"source_column": "sql_query_output"},
            "response": {"source_column": "carbon_chart"}
        }
    },
    "type_appropriateness": {
        "description": "A metric that answers the question 'Is the selected chart type appropriate for the data and question?'",
        "rubric": "1 (Optimal): Chart type is the best choice for visualizing this data. 0 (Inappropriate): Chart type is completely wrong for this data.",
        "threshold": 0.8,
        "range": "[0, 1]",
        "agents": ["visualization"],
        "template": "You are a data visualization expert. Your task is to evaluate whether the selected chart type is appropriate for the data being visualized and the user's question. Assign a score from 0 to 1, where 1 is optimal and 0 is inappropriate.\n\n### Chart Type Guidelines:\n- **Bar Chart**: Best for comparing categorical data, showing counts or totals across categories\n- **Line Chart**: Best for showing trends over time or continuous data\n- **Pie Chart**: Best for showing parts of a whole (proportions), limited number of categories\n- **Scatter Plot**: Best for showing relationships between two continuous variables\n- **Histogram**: Best for showing distribution of continuous numerical data\n\n### Criteria:\n- Chart type should match the nature of the data (categorical vs. continuous)\n- Chart type should be effective for the type of comparison or analysis needed\n- Chart type should help answer the user's question effectively\n- Chart type should follow data visualization best practices\n\n### Rating Rubric:\n**1.0 (Optimal)**:\n- Chart type is the best possible choice for this data\n- Effectively communicates the insights the user needs\n- Follows data visualization best practices\n- Makes patterns or answers immediately clear\n\n**0.7-0.9 (Good)**:\n- Chart type is appropriate and effective\n- A slightly better alternative might exist\n- Still communicates the information clearly\n\n**0.4-0.6 (Acceptable)**:\n- Chart type works but is not ideal\n- Another chart type would be significantly better\n- Some aspects of the data are hard to interpret\n\n**0.1-0.3 (Poor)**:\n- Chart type is a poor choice for this data\n- Misleading or confusing visualization\n- Much better alternatives exist\n\n**0.0 (Inappropriate)**:\n- Chart type is completely wrong for this data\n- Cannot effectively communicate the information\n- Violates basic data visualization principles\n\n### Evaluation Steps:\n1. Analyze the user's question to understand what they want to learn\n2. Review the SQL query output to understand data types and structure\n3. Identify the chart type used in the Carbon chart\n4. Assess if the data is categorical, continuous, time-series, etc.\n5. Determine if the chart type matches the data characteristics\n6. Consider if the chart type effectively answers the user's question\n7. Evaluate against data visualization best practices\n8. Consider alternative chart types that might be better\n9. Assign a score based on the rubric\n\nProvide a step-by-step explanation for your score.\n\n# User Inputs and AI-generated Response\n## User Inputs\n### User Question\n{prompt}\n\n### SQL Query Output (for context)\n{context}\n\n## AI-generated Response\n### Generated Carbon Chart\n{response}",
        "dataset_mapping": {
            "prompt": {"source_column": "user_inputs"},
            "context": {"source_column": "sql_query_output"},
            "response": {"source_column": "carbon_chart"}
        }
    }
}
}